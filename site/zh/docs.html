<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0f1419">
  <meta name="description" content="HomeClaw 文档：混合模式、插件、技能、渠道、伴侣应用、记忆、知识库。配置与入门。">
  <title>文档 — HomeClaw</title>
  <link rel="icon" type="image/png" href="../assets/homeclaw-logo.png">
  <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
  <header class="site-nav-wrap">
  <nav class="site-nav" aria-label="主导航">
    <div class="site-nav-inner">
      <a href="index.html" class="site-logo-wrap">
        <img src="../assets/homeclaw-logo.png" alt="HomeClaw" class="site-logo-img" width="32" height="32">
        <span>HomeClaw</span>
      </a>
      <div class="site-links">
        <a href="index.html">首页</a>
        <a href="docs.html#quickstart">快速开始</a>
        <a href="docs.html#deploy-cloud">部署到云</a>
        <a href="plugins-skills.html">插件与技能</a>
        <a href="docs.html">文档</a>
        <a href="https://github.com/allenpeng0705/HomeClaw" target="_blank" rel="noopener"><svg class="site-nav-icon site-nav-icon-github" aria-hidden="true" width="18" height="18" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg> GitHub</a>
        <a href="https://allenpeng0705.github.io/HomeClaw/" target="_blank" rel="noopener">完整文档</a>
        <span class="lang-switch"><a href="../en/docs.html">EN</a> | 中文</span>
      </div>
    </div>
  </nav>
  </header>

  <main class="container doc-content">
    <div class="doc-intro">
      <h1>HomeClaw 文档</h1>
      <p class="lead">详细介绍与配置说明。完整文档（安装、高级配置）请访问 <a href="https://allenpeng0705.github.io/HomeClaw/" target="_blank" rel="noopener">文档站</a>。</p>
      <p>HomeClaw 是运行在你机器上的 AI 助手。支持 <strong>Mac、Windows、Linux</strong>（Python 技术栈），并可用<strong>任意语言编写外部插件</strong>扩展（Node.js、Go、Java 等）。一次安装即一个智能体：无论通过何种方式连接，记忆、工具、插件和知识库都一致。可使用云端或本地模型，或通过<strong>混合模式</strong>两者结合。以下为主要功能及配置要点。</p>
    </div>

    <nav class="doc-toc" aria-label="本页导航">
      <p class="doc-toc-title">本页导航</p>
      <ul>
        <li><a href="#quickstart">快速开始</a></li>
        <li><a href="#deploy-cloud">部署到云</a></li>
        <li><a href="#mix-mode">1. 混合模式</a></li>
        <li><a href="#plugins-skills">2. 插件与技能</a></li>
        <li><a href="#channels">3. 渠道</a></li>
        <li><a href="#companion">4. 伴侣应用</a></li>
        <li><a href="#multi-agent">5. 多智能体</a></li>
        <li><a href="#memory">6. 记忆</a></li>
        <li><a href="#knowledge-base">7. 知识库</a></li>
        <li><a href="#profile">8. 个人资料</a></li>
      </ul>
    </nav>

    <section class="doc-section doc-section-no-img" id="quickstart">
      <div class="doc-section-img-wrap" aria-hidden="true"></div>
      <div class="doc-section-body">
        <h2>快速开始 — 在 Mac、Windows 或 Linux 上运行 HomeClaw</h2>
        <p class="doc-section-summary">克隆、安装、配置（可选）、启动 Core，然后通过 CLI、WebChat 或伴侣应用聊天。</p>
        <p><strong>前置条件：</strong>Python 3（建议 3.9+）、git。Windows 上若出现 C++ 编译错误，请安装 <a href="https://allenpeng0705.github.io/HomeClaw/getting-started/" target="_blank" rel="noopener">Visual C++ 生成工具</a>（见完整文档）。</p>

        <h3>Mac 与 Linux</h3>
        <div class="doc-keys">
          <p class="doc-keys-title">1. 克隆并安装</p>
          <pre class="quickstart-code"><code>git clone https://github.com/allenpeng0705/HomeClaw.git
cd HomeClaw
pip install -r requirements.txt</code></pre>
        </div>
        <div class="doc-keys">
          <p class="doc-keys-title">2. 配置（可选）</p>
          <ul>
            <li><strong>config/core.yml</strong> — 设置 <code>main_llm</code>、<code>embedding_llm</code>（如 <code>cloud_models/Gemini-2.5-Flash</code>）。</li>
            <li><strong>云端模型</strong> — 在环境中设置 API Key（如 <code>export GEMINI_API_KEY=...</code>）。</li>
            <li><strong>本地模型</strong> — 将 llama.cpp <strong>二进制发行版</strong> 复制到 <code>llama.cpp-master/&lt;platform&gt;/</code>，按设备选择目录（如 <code>mac/</code>、<code>win_cuda/</code>、<code>linux_cpu/</code>；见仓库中 <code>llama.cpp-master/README.md</code>）。</li>
            <li><strong>config/user.yml</strong> — 添加用户（name、email、im 等），使其可与助手对话。</li>
          </ul>
        </div>
        <div class="doc-keys">
          <p class="doc-keys-title">3. 启动 Core</p>
          <pre class="quickstart-code"><code>python -m main start</code></pre>
          <p>会启动 Core 与内置 CLI，可在同一终端中聊天。</p>
        </div>
        <div class="doc-keys">
          <p class="doc-keys-title">4. 聊天</p>
          <ul>
            <li><strong>CLI</strong> — 在运行 <code>python -m main start</code> 的同一终端使用交互式聊天。</li>
            <li><strong>WebChat</strong> — 在另一终端运行 <code>python -m channels.run webchat</code>，然后打开 http://localhost:8014。</li>
            <li><strong>伴侣应用</strong> — 从 <code>clients/homeclaw_companion/</code> 构建或安装；在设置中将 <strong>Core URL</strong> 设为 <code>http://127.0.0.1:9000</code>（远程则填 Tailscale/隧道 URL）。</li>
          </ul>
        </div>
        <p><strong>检查配置与 LLM：</strong><code>python -m main doctor</code>。</p>

        <h3>Windows</h3>
        <p>步骤与上相同。根据 Python 环境使用 <code>py -m main start</code> 或 <code>python -m main start</code>。若编译原生扩展时报错，请安装 <a href="https://github.com/bycloudai/InstallVSBuildToolsWindows" target="_blank" rel="noopener">Visual C++ 生成工具</a>（见完整文档中的 <a href="https://allenpeng0705.github.io/HomeClaw/getting-started/" target="_blank" rel="noopener">getting-started</a>）。</p>
      </div>
    </section>

    <section class="doc-section doc-section-no-img" id="deploy-cloud">
      <div class="doc-section-img-wrap" aria-hidden="true"></div>
      <div class="doc-section-body">
        <h2>部署到云</h2>
        <p class="doc-section-summary">在云主机（阿里云 ECS、AWS EC2 等）上运行 HomeClaw，实现 7×24 在线、随时随地访问。</p>
        <p>可将 HomeClaw 部署到<strong>云虚拟机</strong>（VPS），让助手常驻在线——伴侣应用、Telegram、WebChat 均可使用，无需本地电脑一直开机。步骤与快速开始相同，仅创建虚拟机与开放防火墙的方式因云厂商而异。</p>
        <h3>步骤</h3>
        <ol>
          <li><strong>创建虚拟机</strong> — <strong>阿里云 ECS</strong>、<strong>AWS EC2</strong>、<strong>腾讯云</strong>、<strong>GCP</strong>、<strong>Azure</strong> 或任意 VPS。选择 <strong>Ubuntu 22.04</strong>（或 20.04）。</li>
          <li><strong>安装与运行</strong> — SSH 登录后，与快速开始一致：克隆仓库、<code>pip install -r requirements.txt</code>、编辑 <code>config/core.yml</code> 与 <code>config/user.yml</code>、在环境中设置 API Key。若使用<strong>本地模型</strong>，将 llama.cpp 二进制复制到 <code>llama.cpp-master/&lt;platform&gt;/</code>（如 <code>linux_cpu/</code>；见 <code>llama.cpp-master/README.md</code>）。然后 <code>python -m main start</code>。</li>
          <li><strong>保护 Core</strong> — 在 <code>config/core.yml</code> 中设置 <code>auth_enabled: true</code> 和 <code>auth_api_key: "&lt;长随机密钥&gt;"</code>。防火墙仅开放 <strong>9000</strong>（及 22 用于 SSH），或使用 <strong>Cloudflare Tunnel</strong> / <strong>Tailscale</strong> 将 9000 保留在内网。</li>
          <li><strong>保持运行</strong> — 使用 <strong>systemd</strong>（或 supervisor）使 Core 在重启后自动拉起。完整文档中有示例服务文件。</li>
        </ol>
        <p><strong>伴侣应用：</strong>将 Core URL 设为 <code>http://&lt;云主机公网 IP&gt;:9000</code>（或隧道 URL），并填写相同 API Key。</p>
        <p><a href="https://allenpeng0705.github.io/HomeClaw/deploy-cloud/" target="_blank" rel="noopener">完整指南：部署到云</a>（阿里云 ECS、AWS EC2、安全、systemd） · <a href="https://allenpeng0705.github.io/HomeClaw/remote-access/" target="_blank" rel="noopener">远程访问</a>（Tailscale、Cloudflare Tunnel）</p>
      </div>
    </section>

    <section class="doc-section" id="mix-mode">
      <div class="doc-section-img-wrap">
        <img src="../assets/section-mix-mode.png" alt="混合模式" class="doc-section-img" width="320" height="180" onerror="this.style.display='none'">
      </div>
      <div class="doc-section-body">
        <h2>1. 混合模式 — 省成本</h2>
        <p class="doc-section-summary">每条消息由路由器选择本地或云端；每轮一个模型、用量报告，可选失败时切换路由。</p>
        <p>对每条用户消息，路由器只选一次：<strong>本地</strong>或<strong>云端</strong>。简单或私密任务走本地；复杂或不确定的走云端。自动路由并有用量报告（聊天或 API），便于调整规则。</p>
        <h3>如何配置</h3>
        <div class="doc-keys">
          <p class="doc-keys-title">在 <code>config/core.yml</code> 中</p>
          <ul>
            <li><strong>main_llm_mode：</strong><code>local</code> | <code>cloud</code> | <code>mix</code> — 设为 <code>mix</code> 启用路由。</li>
            <li><strong>main_llm_local</strong> — 如 <code>local_models/main_vl_model_4B</code>。</li>
            <li><strong>main_llm_cloud</strong> — 如 <code>cloud_models/Gemini-2.5-Flash</code>。</li>
            <li><strong>hybrid_router：</strong><code>default_route</code>（无层决定时用 local/cloud）、<code>fallback_on_llm_error</code>、<code>heuristic</code>（enabled、threshold、rules_path）、<code>semantic</code>、<code>slm</code>（可选分类器模型）。</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="doc-section" id="plugins-skills">
      <div class="doc-section-img-wrap">
        <img src="../assets/section-plugins-skills.png" alt="插件与技能" class="doc-section-img" width="320" height="180" onerror="this.style.display='none'">
      </div>
      <div class="doc-section-body">
        <h2>2. 插件与技能 — 扩展能力</h2>
        <p class="doc-section-summary">内置与外部插件；OpenClaw 风格技能，位于 <code>config/skills/</code>，使用 SKILL.md。</p>
        <h3>插件</h3>
        <p><strong>内置</strong>（Python）：<code>plugins/&lt;Name&gt;/</code>，含 <code>plugin.yaml</code>、<code>config.yml</code>、<code>plugin.py</code>。已包含：<strong>Weather</strong>、<strong>News</strong>、<strong>PptMaker</strong>。</p>
        <p><strong>外部</strong>（任意语言）：HTTP 服务实现 <code>GET /health</code> 和 <code>POST /run</code>。通过 <code>POST /api/plugins/register</code> 注册。LLM 在意图匹配时调用 <code>route_to_plugin(plugin_id, capability_id, parameters)</code>。</p>
        <h3>技能</h3>
        <p><code>config/skills/</code> 下的文件夹，内含 <strong>SKILL.md</strong>（名称、描述、可选工作流正文）。LLM 看到「可用技能」并使用工具或 <strong>run_skill</strong> 执行脚本。可直接复制 OpenClaw/ClawHub 技能文件夹使用。</p>
        <h3>自己编写</h3>
        <p>编写插件或技能请参阅完整指南 <strong><a href="plugins-skills.html">编写插件与技能</a></strong> — 内置与外置插件（任意语言）、SKILL.md 格式，以及 <code>examples/external_plugins/</code> 中的示例（Python、Node.js、Go、Java）。我们计划在未来提供<strong>插件与技能的发现、上传与下载网站</strong>。</p>
        <div class="doc-keys">
          <p class="doc-keys-title">配置</p>
          <ul>
            <li><code>use_skills: true</code>、<code>skills_dir: config/skills</code>；可选 <code>skills_use_vector_search</code>、<code>skills_test_dir</code>，<code>tools</code> 下 <code>run_skill_allowlist</code>。</li>
            <li>自带示例：<code>example</code>、<code>social-media-agent-1.0.0</code>、<code>linkedin-writer-1.0.0</code>、<code>desktop-ui</code>、<code>ip-cameras</code>。</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="doc-section" id="channels">
      <div class="doc-section-img-wrap">
        <img src="../assets/section-channels.png" alt="渠道" class="doc-section-img" width="320" height="180" onerror="this.style.display='none'">
      </div>
      <div class="doc-section-body">
        <h2>3. 渠道 — 远程访问</h2>
        <p class="doc-section-summary">WebChat、Telegram、Discord、CLI 等共用同一 Core；user.yml 白名单；会话与远程访问选项。</p>
        <p>渠道是用户连接 Core 的方式。均使用同一 Core、记忆和 <strong>config/user.yml</strong> 白名单（name、email、im、phone、permissions）。仅列出的用户可对话 — 即<strong>隐私与访问控制</strong>。</p>
        <h3>会话管理</h3>
        <p>在 core.yml 的 <code>session:</code> 下：<strong>dm_scope</strong>（main | per-peer | per-channel-peer | per-account-channel-peer）、<strong>identity_links</strong>（同一人多渠道共会话）、<strong>prune_keep_last_n</strong>、<strong>prune_after_turn</strong>、<strong>daily_reset_at_hour</strong>、<strong>idle_minutes</strong>、<strong>api_enabled</strong>。数据按系统用户 id 隔离。</p>
        <h3>远程访问</h3>
        <ul>
          <li><strong>认证：</strong><code>auth_enabled: true</code>、<code>auth_api_key</code>；客户端在 /inbound 和 /ws 上发送 <code>X-API-Key</code> 或 <code>Authorization: Bearer</code>。</li>
          <li><strong>Tailscale：</strong>从其他 Tailscale 节点使用 Tailscale IP（如 100.x.x.x:9000）；无需公网暴露。</li>
          <li><strong>Tailscale Funnel + 认证代理：</strong>公网 HTTPS，前置于代理，供 webhook/机器人使用。</li>
        </ul>
      </div>
    </section>

    <section class="doc-section" id="companion">
      <div class="doc-section-img-wrap">
        <img src="../assets/section-companion.png" alt="伴侣应用" class="doc-section-img" width="320" height="180" onerror="this.style.display='none'">
      </div>
      <div class="doc-section-body">
        <h2>4. 伴侣应用</h2>
        <p class="doc-section-summary">Flutter 应用，支持 Mac、Windows、iPhone、Android：聊天、语音、管理 Core（编辑 core.yml、user.yml）。</p>
        <p><strong>HomeClaw 伴侣应用</strong>通过 HTTP 与 Core 通信，与其他渠道相同。</p>
        <h3>功能</h3>
        <ul>
          <li><strong>聊天</strong> — 消息、图片、文件、历史。</li>
          <li><strong>语音</strong> — 输入与 TTS。</li>
          <li><strong>管理 Core</strong> — 在应用内编辑 core.yml、user.yml（服务器、LLM、记忆、会话、个人资料、技能、工具、认证、用户）；无需 SSH。</li>
        </ul>
        <h3>如何使用</h3>
        <p>从 <code>clients/homeclaw_companion/</code> 构建。设置 <strong>Core URL</strong>（如 http://127.0.0.1:9000 或 Tailscale URL）。若启用 <code>auth_enabled</code> 则填写 API Key。在 user.yml 或通过「管理 Core」→ 用户添加用户。macOS 用户请参阅权限说明。</p>
      </div>
    </section>

    <section class="doc-section" id="multi-agent">
      <div class="doc-section-img-wrap">
        <img src="../assets/section-multi-agent.png" alt="多智能体" class="doc-section-img" width="320" height="180" onerror="this.style.display='none'">
      </div>
      <div class="doc-section-body">
        <h2>5. 多智能体</h2>
        <p class="doc-section-summary">一个实例即一个智能体；多实例即多智能体（不同端口/配置）。</p>
        <p>在不同端口（如 9000、9001）运行多个 Core 实例。将伴侣应用或任意渠道指向对应 URL。每个实例有各自的记忆、工具、插件和知识库。无中心编排。</p>
      </div>
    </section>

    <section class="doc-section" id="memory">
      <div class="doc-section-img-wrap">
        <img src="../assets/section-memory.png" alt="记忆" class="doc-section-img" width="320" height="180" onerror="this.style.display='none'">
      </div>
      <div class="doc-section-body">
        <h2>6. 记忆</h2>
        <p class="doc-section-summary">RAG 风格记忆（向量 + 关系型）与基于 Markdown 文件的记忆（AGENT_MEMORY.md、每日文件）；按用户隔离；后端 Cognee 或 Chroma。</p>
        <p>HomeClaw 保存记忆以便助手记住并召回过往上下文。除向量/关系型（Cognee 或 Chroma）外，还支持<strong>基于 Markdown 文件的记忆</strong>：如 <code>AGENT_MEMORY.md</code> 作为长期智能体上下文，以及每日记忆文件 <code>YYYY-MM-DD.md</code> 作为有界的短期上下文。所有记忆按系统用户 id 隔离。</p>
        <div class="doc-keys">
          <p class="doc-keys-title">配置</p>
          <ul>
            <li><code>use_memory: true</code>、<code>memory_backend: cognee</code>（默认）或 <code>chroma</code>。文件型：<code>use_agent_memory_file</code>、<code>agent_memory_path</code>、<code>use_daily_memory</code>、<code>daily_memory_dir</code>。</li>
            <li>重置：<code>POST</code> 或 <code>GET http://&lt;core&gt;:&lt;port&gt;/memory/reset</code>。</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="doc-section" id="knowledge-base">
      <div class="doc-section-img-wrap">
        <img src="../assets/section-knowledge-base.png" alt="知识库" class="doc-section-img" width="320" height="180" onerror="this.style.display='none'">
      </div>
      <div class="doc-section-body">
        <h2>7. 知识库</h2>
        <p class="doc-section-summary">每用户知识库：文档、URL、手动内容；RAG 工具与可选的文件上传自动加入。</p>
        <p>当 <code>knowledge_base.enabled: true</code> 时，可使用 <strong>knowledge_base_add</strong> 等工具与检索。文件理解可在用户仅发送文件且未超限时自动加入 KB。</p>
        <div class="doc-keys">
          <p class="doc-keys-title">配置</p>
          <ul>
            <li><code>knowledge_base:</code> 下 — <code>enabled</code>、<code>backend</code>（auto | cognee | chroma）、<code>chunk_size</code>、<code>chunk_overlap</code>、<code>unused_ttl_days</code>、<code>max_sources_per_user</code>、<code>retrieval_min_score</code>。<code>file_understanding.add_to_kb_max_chars</code> 控制自动加入。</li>
            <li>重置：<code>POST</code> 或 <code>GET http://&lt;core&gt;:&lt;port&gt;/knowledge_base/reset</code>。</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="doc-section" id="profile">
      <div class="doc-section-img-wrap">
        <img src="../assets/section-profile.png" alt="个人资料" class="doc-section-img" width="320" height="180" onerror="this.style.display='none'">
      </div>
      <div class="doc-section-body">
        <h2>8. 个人资料</h2>
        <p class="doc-section-summary">每用户 JSON 资料（姓名、生日、偏好）；助手可通过工具读写。</p>
        <p>学习到的事实按用户存为 JSON 文件（以系统用户 id 为键）。用于个性化。</p>
        <div class="doc-keys">
          <p class="doc-keys-title">配置</p>
          <ul>
            <li><code>profile.enabled: true</code>、<code>profile.dir</code>（空则 <code>database/profiles</code>）。见 <code>docs/UserProfileDesign.md</code>。</li>
          </ul>
        </div>
      </div>
    </section>

    <div class="doc-quicklinks">
      <h2>快速链接</h2>
      <ul>
        <li><a href="https://github.com/allenpeng0705/HomeClaw" target="_blank" rel="noopener">GitHub 仓库</a></li>
        <li><a href="https://allenpeng0705.github.io/HomeClaw/" target="_blank" rel="noopener">完整文档</a>（安装、模型、插件、混合模式、渠道、记忆、知识库）</li>
      </ul>
    </div>
  </main>

  <footer class="site-footer">
    <p>HomeClaw — 你的家，你的 AI。<a href="https://github.com/allenpeng0705/HomeClaw" target="_blank" rel="noopener">GitHub</a> · <a href="https://allenpeng0705.github.io/HomeClaw/" target="_blank" rel="noopener">文档</a></p>
  </footer>
</body>
</html>
